<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <body>
        <ui:composition>
            <h:panelGroup id="route-view-container" layout="group" class="row" rendered="#{param.mode == 'view'}">
                <div class="col-md-12">
                    <div class="material-container">
                        <div class="box-toolbar">
                            <span class="left title-big"><h:outputText value="#{routeBean.route.name}"/></span>
                            <h:form>
                                <p:commandLink styleClass="right material-button-flat no-select" action="#{navBB.goEvent(routeBean.eventId)}">
                                    <span class="glyphicon glyphicon-chevron-left margin-right-10"/><h:outputText value="#{routeBean.event.name}"/>
                                    <f:param name="eventId" value="#{routeBean.eventId}"/>
                                    <f:param name="routeId" value="#{routeBean.routeId}"/>
                                    <f:param name="mode" value="view"/>
                                </p:commandLink>
                            </h:form>
                        </div>

                        <div class="box-content">
                            <div class="row">
                                <div class="col-md-6 material-container">
                                    <h:panelGroup layout="block" styleClass="box-toolbar divider" style="border-color: #{routeBean.route.hexColor}">
                                        <span class="left title"><h:outputText value="Route Information"/></span>
                                        <h:form>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="EDIT" action="#{routeBean.editRouteInfo}" update=":edit-route-info-dlg" oncomplete="PF('edit-route-info-dlg').show();">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                        </h:form>
                                    </h:panelGroup>
                                    <div class="box-content">
                                        <h:outputText styleClass="font500" value="Time:"/><br/>
                                        <h:outputText styleClass="font300" value="#{routeBean.route.date.toString('HH:mm')}"/><br/><br/>

                                        <h:outputText styleClass="font500" value="Information:"/><br/>
                                        <h:outputText styleClass="font300" value="#{routeBean.route.information}"/><br/><br/>
                                    </div>
                                </div>

                                <div class="col-md-6 material-container">
                                    <h:panelGroup layout="block" styleClass="box-toolbar divider" style="border-color: #{routeBean.route.hexColor}">
                                        <span class="left title"><h:outputText value="Stations"/></span>
                                        <h:form>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="ADD" action="#{routeBean.clearStation}" update=":view-add-station-dlg" oncomplete="PF('view-add-station-dlg').show();">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="REORDER" action="#{routeBean.setUpStationReorderMap}"
                                                           update=":view-reorder-station-dlg" oncomplete="PF('view-reorder-station-dlg').show();"
                                                           rendered="#{routeBean.route.stations.size() gt 1}">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                        </h:form>
                                    </h:panelGroup>
                                    <div class="box-content">
                                        <h:form>
                                            <p:dataTable value="#{routeBean.route.stations}" var="station" rowIndexVar="row" style="text-align: center;">
                                                <p:column headerText="Sequence Position">
                                                    <h:outputText value="#{station.sequencePosition}"/>
                                                </p:column>

                                                <p:column headerText="Name">
                                                    <p:commandLink styleClass="material-button-flat no-select" value="#{station.name}" action="#{routeBean.showStation(row)}" update=":station-info-dlg" oncomplete="PF('station-info-dlg').show();">
                                                        <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                        <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                        <f:param name="mode" value="view"/>
                                                    </p:commandLink>
                                                </p:column>

                                                <p:column headerText="Location">
                                                    <h:outputText value="#{station.location}"/>
                                                </p:column>

                                                <p:column headerText="Time limit">
                                                    <h:outputText value="#{station.timeLimit} min"/>
                                                </p:column>

                                                <p:column headerText="Relocation time">
                                                    <h:outputText value="#{station.relocationTime} min"/>
                                                </p:column>

                                                <p:column headerText="Actions" rendered="#{acl.hasPermission(routeBean.route.id, routeBean.route.ACLObjectIdentityClass, 'WRITE')}">
                                                    <div class="right">
                                                        <p:commandButton styleClass="material-button-image image-button-edit ui-button-icon-only no-select"
                                                                         action="#{routeBean.editStation(station.id)}" value="" update=":edit-station-dlg" oncomplete="PF('edit-station-dlg').show();">
                                                            <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                            <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                            <f:param name="mode" value="view"/>
                                                        </p:commandButton>

                                                        <p:commandButton styleClass="material-button-image image-button-delete ui-button-icon-only no-select"
                                                                         actionListener="#{routeBean.removeStation(station.id)}" value="" update="@form :route-view-container">
                                                            <p:confirm header="Confirmation" message="Do you really want to delete this station?" icon="icon-empty"/>
                                                            <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                            <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                            <f:param name="mode" value="view"/>
                                                        </p:commandButton>
                                                    </div>
                                                </p:column>

                                            </p:dataTable>
                                        </h:form>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 material-container">
                                    <h:panelGroup layout="block" styleClass="box-toolbar divider" style="border-color: #{routeBean.route.hexColor}">
                                        <span class="left title"><h:outputText value="Groups"/></span>
                                        <h:form>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="ADD" action="#{routeBean.setUpEmptyRouteHolder}" update=":view-add-group-dlg" oncomplete="PF('view-add-group-dlg').show();">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="REORDER" action="#{routeBean.setUpGroupReorderMap}"
                                                           update=":view-reorder-groups-dlg" oncomplete="PF('view-reorder-groups-dlg').show();"
                                                           rendered="#{routeBean.route.groups.size() gt 1}">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                        </h:form>
                                    </h:panelGroup>
                                    <div class="box-content">
                                        <p:dataTable value="#{routeBean.route.groups}" var="group" style="text-align: center;">
                                            <p:column headerText="Group leader">
                                                <h:outputText value="#{group.guide.email}"/>
                                            </p:column>

                                            <p:column headerText="Starts at">
                                                <h:outputText value="#{routeBean.route.stations.get(group.startingPosition - 1).name}" rendered="#{(group.startingPosition - 1) lt routeBean.route.stations.size()}"/>
                                                <h:panelGroup layout="block" styleClass="table-alert alert-danger" rendered="#{(group.startingPosition - 1) ge routeBean.route.stations.size()}">
                                                    <h:outputText value="NO STATION"/>
                                                </h:panelGroup>
                                            </p:column>

                                            <p:column headerText="Start number">
                                                <h:outputText value="#{group.startingPosition}"/>
                                            </p:column>

                                            <p:column rendered="#{acl.hasPermission(routeBean.route.id, routeBean.route.ACLObjectIdentityClass, 'WRITE')}">
                                                <div class="right">
                                                    <h:form>
                                                        <p:commandButton styleClass="material-button-image image-button-delete ui-button-icon-only no-select"
                                                                         actionListener="#{routeBean.removeGroup(group.id)}" value="" update="@form :route-view-container">
                                                            <p:confirm header="Confirmation" message="Do you really want to delete this group?" icon="icon-empty"/>
                                                            <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                            <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                            <f:param name="mode" value="view"/>
                                                        </p:commandButton>
                                                    </h:form>
                                                </div>
                                            </p:column>

                                        </p:dataTable>
                                    </div>
                                </div>

                                <div class="col-md-6 material-container">
                                    <h:panelGroup layout="block" styleClass="box-toolbar divider" style="border-color: #{routeBean.route.hexColor}">
                                        <span class="left title"><h:outputText value="Station Managers"/></span>
                                        <h:form>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="ADD" action="#{routeBean.setUpEmptyRouteHolder}" update=":add-stationmanager-dlg" oncomplete="PF('add-stationmanager-dlg').show();">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                        </h:form>
                                    </h:panelGroup>
                                    <div class="box-content">
                                        <p:dataTable value="#{routeBean.route.stationManagers}" var="manager" styleClass="no-header">
                                            <p:column>
                                                <h:outputText value="#{manager.email}"/>
                                            </p:column>

                                            <p:column rendered="#{acl.hasPermission(routeBean.route.id, routeBean.route.ACLObjectIdentityClass, 'WRITE')}">
                                                <div class="right">
                                                    <h:form>
                                                        <p:commandButton styleClass="material-button-image image-button-delete ui-button-icon-only no-select"
                                                                         actionListener="#{routeBean.removeStationManager(manager.email)}" value="" update="@form :route-view-container">
                                                            <p:confirm header="Confirmation" message="Do you really want to delete this station manager?" icon="icon-empty"/>
                                                            <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                            <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                            <f:param name="mode" value="view"/>
                                                        </p:commandButton>
                                                    </h:form>
                                                </div>
                                            </p:column>
                                        </p:dataTable>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </h:panelGroup>
        </ui:composition>
    </body>

</html>