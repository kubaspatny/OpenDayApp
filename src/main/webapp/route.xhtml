<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="#{localeBean.language}"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
<f:view locale="#{localeBean.locale}">
    <h:head>

        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>

        <title>Open Days</title>

        <h:outputScript library="primefaces" name="jquery/jquery.js" target="head"/>
        <h:outputScript target="head">
            $ = jQuery;
        </h:outputScript>

        <h:outputScript name="js/bootstrap.js"/>
        <h:outputScript name="js/primefaces-calendar.js"/>
        <link href='http://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700,900' rel='stylesheet' type='text/css'/>

    </h:head>

    <f:metadata>
        <f:viewParam name="eventId" value="#{routeBean.eventId}" />
        <f:viewParam name="routeId" value="#{routeBean.routeId}" />
        <f:viewParam name="mode" value="#{routeBean.mode}" />
        <f:event type="preRenderView" listener="#{routeBean.init}" />
    </f:metadata>

    <h:body>
        <h:outputStylesheet name="css/bootstrap.css" />
        <h:outputStylesheet name="css/logo.css" />
        <h:outputStylesheet name="css/main.css" />

        <!-- DIALOGS -->
        <p:dialog header="Add time" widgetVar="add-time-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="add-time-form" styleClass="form-table">

                <h:panelGrid id="add-time-panel" columns="1">

                    <h:panelGroup layout="block">
                        <h:outputText styleClass="font500" value="Hours: "/>
                        <h:outputText styleClass="font300" id="time-output-hour" value="#{routeBean.cvo.newTimeHour}"/>
                    </h:panelGroup>

                    <h:panelGroup layout="block">
                        <h:outputText styleClass="font500" value="Minutes: "/>
                        <h:outputText styleClass="font300" id="time-output-minute" value="#{routeBean.cvo.newTimeMinute}"/>
                    </h:panelGroup>


                    <h:inputHidden id="hour" value="#{routeBean.cvo.newTimeHour}" />
                    <p:slider for="hour" minValue="0" maxValue="23" display="time-output-hour" style="width: 200px" displayTemplate="{value}" />

                    <h:inputHidden id="minute" value="#{routeBean.cvo.newTimeMinute}" />
                    <p:slider for="minute" minValue="0" maxValue="59" display="time-output-minute" style="width: 200px" displayTemplate="{value}" />

                    <h:panelGroup layout="block" styleClass="alert alert-danger margin-top-10" rendered="#{routeBean.cvo.errorDuplicateTime}">
                        <h:outputText value="DUPLICATE TIMES"/>
                    </h:panelGroup>

                </h:panelGrid>
                <p:commandButton id="submit" value="Add time" styleClass="margin-top-10" update="add-time-form" ajax="true"
                                 action="#{routeBean.addNewTime}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed &amp;&amp; !args.errorDuplicateTime) PF('add-time-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}" />
                    <f:param name="mode" value="create"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog header="Add group" widgetVar="add-group-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="add-group-form" styleClass="form-table">

                <h:panelGrid id="add-group-panel" columns="1">

                    <p:selectOneListbox value="#{routeBean.cvo.newGroupEmail}" var="e" filter="true" filterMatchMode="contains">
                        <f:selectItems value="#{routeBean.event.emailList}" var="email" itemLabel="#{email}" itemValue="#{email}" />

                        <p:column>
                            <h:outputText value="#{e}" />
                        </p:column>

                    </p:selectOneListbox>

                    <h:panelGroup layout="block" styleClass="alert alert-danger margin-top-10" rendered="#{routeBean.cvo.errorDuplicateGroup}">
                        <h:outputText value="GROUP WITH THIS EMAIL ALREADY EXISTS"/>
                    </h:panelGroup>

                </h:panelGrid>
                <p:commandButton value="Add group" styleClass="margin-top-10" update="add-group-form" ajax="true"
                                 action="#{routeBean.addNewGroup}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed &amp;&amp; !args.errorDuplicateGroup) PF('add-group-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}" />
                    <f:param name="mode" value="create"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog header="Reorder groups" widgetVar="reorder-group-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="reorder-group-form" styleClass="form-table">

                <h:panelGrid id="reorder-group-panel" columns="1">
                    <p:orderList value="#{routeBean.cvo.reorderGroups}" var="gr" controlsLocation="none" itemLabel="#{gr}" itemValue="#{gr}" rendered="#{not empty routeBean.cvo.groups}"/>
                </h:panelGrid>
                <p:commandButton value="OK" styleClass="margin-top-10" update="reorder-group-form" ajax="true"
                                 action="#{routeBean.reorderGroups}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed) PF('reorder-group-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}" />
                    <f:param name="mode" value="create"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog header="Add station" widgetVar="add-station-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="add-station-form" styleClass="form-table">

                <h:panelGrid columns="3">

                    <p:outputLabel for="station-name" value="Station name" styleClass="sr-only"/>
                    <p:inputText id="station-name" value="#{routeBean.cvo.newStation.name}" validator="#{routeBean.validateStationNameUniqueConstraint}" placeholder="Station name" styleClass="form-control" required="true" requiredMessage="Fill in Station's name">
                        <p:ajax update="msgStationName" event="keyup"/>
                    </p:inputText>
                    <p:message for="station-name" id="msgStationName" display="text"/>

                    <p:outputLabel for="station-location" value="NAME" styleClass="sr-only"/>
                    <p:inputText id="station-location" value="#{routeBean.cvo.newStation.location}" placeholder="Station location" styleClass="form-control" required="true" requiredMessage="Fill in Station's location">
                        <p:ajax update="msgStationLocation" event="keyup"/>
                    </p:inputText>
                    <p:message for="station-location" id="msgStationLocation" display="text"/>

                    <p:outputLabel for="station-info" value="Station info" styleClass="sr-only"/>
                    <p:inputTextarea id="station-info" autoResize="false" rows="6" cols="30" value="#{routeBean.cvo.newStation.information}" styleClass="form-control" placeholder="Station information"/>
                    <p:message for="station-info" id="msgStationInfo" display="text"/>

                    <h:outputLabel for="station-time-limit" value="Time limit" styleClass="sr-only"/>
                    <p:spinner id="station-time-limit" value="#{routeBean.cvo.newStation.timeLimit}" min="0" max="1000" placeholder="Time limit" styleClass="spinner"/>
                    <p:message for="station-info" id="msgStationTimeLimit" display="text"/>

                    <h:outputLabel for="station-relocation-time" value="Relocation time" styleClass="sr-only"/>
                    <p:spinner id="station-relocation-time" value="#{routeBean.cvo.newStation.relocationTime}" min="0" max="1000" placeholder="Relocation time" styleClass="spinner"/>
                    <p:message for="station-relocation-time" id="msgStationRelocationTime" display="text"/>

                </h:panelGrid>
                <p:commandButton value="Add group" styleClass="margin-top-10" update="add-station-form" ajax="true"
                                 action="#{routeBean.addNewStation}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed) PF('add-station-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}" />
                    <f:param name="mode" value="create"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog header="Add station" id="view-add-station-dlg" widgetVar="view-add-station-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="view-add-station-form" styleClass="form-table">

                <h:panelGrid columns="3">

                    <p:outputLabel for="add-station-name" value="Station name" styleClass="sr-only"/>
                    <p:inputText id="add-station-name" value="#{routeBean.editRouteHolder.station.name}" validator="#{routeBean.validateStationNameUniqueConstraint}" placeholder="Station name" styleClass="form-control" required="true" requiredMessage="Fill in Station's name">
                        <p:ajax update="msgAddStationName" event="keyup"/>
                    </p:inputText>
                    <p:message for="add-station-name" id="msgAddStationName" display="text"/>

                    <p:outputLabel for="add-station-location" value="NAME" styleClass="sr-only"/>
                    <p:inputText id="add-station-location" value="#{routeBean.editRouteHolder.station.location}" placeholder="Station location" styleClass="form-control" required="true" requiredMessage="Fill in Station's location">
                        <p:ajax update="msgAddStationLocation" event="keyup"/>
                    </p:inputText>
                    <p:message for="add-station-location" id="msgAddStationLocation" display="text"/>

                    <p:outputLabel for="add-station-info" value="Station info" styleClass="sr-only"/>
                    <p:inputTextarea id="add-station-info" autoResize="false" rows="6" cols="30" value="#{routeBean.editRouteHolder.station.information}" styleClass="form-control" placeholder="Station information"/>
                    <p:message for="add-station-info" id="msgAddStationInfo" display="text"/>

                    <h:outputLabel for="add-station-time-limit" value="Time limit" styleClass="sr-only"/>
                    <p:spinner id="add-station-time-limit" value="#{routeBean.editRouteHolder.station.timeLimit}" min="0" max="1000" placeholder="Time limit" styleClass="spinner"/>
                    <p:message for="add-station-info" id="msgAddStationTimeLimit" display="text"/>

                    <h:outputLabel for="add-station-relocation-time" value="Relocation time" styleClass="sr-only"/>
                    <p:spinner id="add-station-relocation-time" value="#{routeBean.editRouteHolder.station.relocationTime}" min="0" max="1000" placeholder="Relocation time" styleClass="spinner"/>
                    <p:message for="add-station-relocation-time" id="msgAddStationRelocationTime" display="text"/>

                </h:panelGrid>
                <p:commandButton value="Add group" styleClass="margin-top-10" update="@form :route-view-container" ajax="true"
                                 action="#{routeBean.addNewStationToExistingRoute}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed &amp;&amp; !args.errorAddingStation) PF('view-add-station-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}"/>
                    <f:param name="routeId" value="#{routeBean.routeId}"/>
                    <f:param name="mode" value="view"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog header="Reorder stations" widgetVar="reorder-station-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="reorder-station-form" styleClass="form-table">

                <h:panelGrid id="reorder-station-panel" columns="1">
                    <p:orderList value="#{routeBean.cvo.reorderStations}" var="st" itemLabel="#{st}" itemValue="#{st}" controlsLocation="none" rendered="#{not empty routeBean.cvo.stations}"/>
                </h:panelGrid>

                <p:commandButton value="OK" styleClass="margin-top-10" update="reorder-station-form" ajax="true"
                                 action="#{routeBean.changeStationsOrder}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed) PF('reorder-station-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}" />
                    <f:param name="mode" value="create"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog header="Reorder stations" id="view-reorder-station-dlg" widgetVar="view-reorder-station-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="view-reorder-station-form" styleClass="form-table">

                <h:panelGrid id="view-reorder-station-panel" columns="1">
                    <p:orderList value="#{routeBean.editRouteHolder.reorderStations}" var="st" itemLabel="#{st}" itemValue="#{st}" controlsLocation="none" rendered="#{not empty routeBean.editRouteHolder.stations}"/>
                </h:panelGrid>

                <p:commandButton value="Update order" styleClass="margin-top-10" update="@form :route-view-container" ajax="true"
                                 action="#{routeBean.changeStationsOrderExistingRoute}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed &amp;&amp; !args.errorUpdateStationOrder) PF('view-reorder-station-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}" />
                    <f:param name="routeId" value="#{routeBean.routeId}" />
                    <f:param name="mode" value="view"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog id="station-info-dlg" header="Station information" widgetVar="station-info-dlg" resizable="false" draggable="false" modal="true" style="max-width: 500px;">
            <h:form id="station-info-form" styleClass="form-table">

                <h:outputText styleClass="font500" value="Name:"/><br/>
                <h:outputText styleClass="font300" value="#{routeBean.route.stations.get(routeBean.selectedStation).name}"/><br/><br/>
                <h:outputText styleClass="font500" value="Location:"/><br/>
                <h:outputText styleClass="font300" value="#{routeBean.route.stations.get(routeBean.selectedStation).location}"/><br/><br/>
                <h:outputText styleClass="font500" value="Information:"/><br/>
                <h:outputText styleClass="font300" value="#{routeBean.route.stations.get(routeBean.selectedStation).information}"/><br/><br/>
                <h:outputText styleClass="font500" value="Time limit:"/><br/>
                <h:outputText styleClass="font300" value="#{routeBean.route.stations.get(routeBean.selectedStation).timeLimit} min"/><br/><br/>
                <h:outputText styleClass="font500" value="Time needed to next station:"/><br/>
                <h:outputText styleClass="font300" value="#{routeBean.route.stations.get(routeBean.selectedStation).relocationTime} min"/><br/><br/>

            </h:form>
        </p:dialog>

        <p:dialog id="edit-route-info-dlg" header="Edit route information" widgetVar="edit-route-info-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="edit-route-info-form" styleClass="form-table">

                <h:form styleClass="form-table">
                    <h:panelGrid id="edit-route-info-panel" columns="3">

                        <p:outputLabel for="edit-colorPicker" value="COLORPICKER" styleClass="sr-only"/>
                        <p:colorPicker id="edit-colorPicker" value="#{routeBean.editRouteHolder.color}" required="true" requiredMessage="Pick a color!"/>
                        <p:message for="edit-colorPicker" id="msgEditColorPicker" display="text"/>

                        <p:outputLabel for="name" value="NAME" styleClass="sr-only"/>
                        <p:inputText id="name" value="#{routeBean.editRouteHolder.name}" placeholder="NAME" styleClass="form-control" required="true" requiredMessage="FILL IN NAME OF THE ROUTE">
                            <p:ajax update="msgName" event="keyup"/>
                        </p:inputText>
                        <p:message for="name" id="msgName" display="text"/>

                        <span/>
                        <h:panelGrid layout="block" columns="4">
                            <h:outputText styleClass="font500" value="Hours: "/>
                            <h:outputText styleClass="font300" id="edit-time-output-hour" value="#{routeBean.editRouteHolder.newTimeHour}"/>
                            <h:inputHidden id="edit-hour" value="#{routeBean.editRouteHolder.newTimeHour}" />
                            <p:slider for="edit-hour" minValue="0" maxValue="23" display="edit-time-output-hour" style="width: 200px" displayTemplate="{value}" />

                            <h:outputText styleClass="font500" value="Minutes: "/>
                            <h:outputText styleClass="font300" id="edit-time-output-minute" value="#{routeBean.editRouteHolder.newTimeMinute}"/>
                            <h:inputHidden id="edit-minute" value="#{routeBean.editRouteHolder.newTimeMinute}" />
                            <p:slider for="edit-minute" minValue="0" maxValue="59" display="edit-time-output-minute" style="width: 200px" displayTemplate="{value}" />
                        </h:panelGrid>
                        <span/>

                        <p:outputLabel for="info" value="INFO" styleClass="sr-only"/>
                        <p:inputTextarea id="info" autoResize="false" rows="6" cols="30" value="#{routeBean.editRouteHolder.information}" styleClass="form-control" placeholder="Route INFORMATION"/>

                    </h:panelGrid>
                    <p:commandButton value="UPDATE ROUTE INFORMATION" styleClass="margin-top-10" update="@form :route-view-container"
                                     actionListener="#{routeBean.updateRouteInfo}"
                                     oncomplete="if (args &amp;&amp; !args.validationFailed &amp;&amp; !args.errorUpdatingRoute) PF('edit-route-info-dlg').hide()">
                        <f:param name="eventId" value="#{routeBean.eventId}"/>
                        <f:param name="routeId" value="#{routeBean.routeId}"/>
                        <f:param name="mode" value="view"/>
                    </p:commandButton>

                    <h:panelGroup layout="block" styleClass="alert alert-danger margin-top-10" rendered="#{routeBean.errorUpdatingRoute}">
                        <h:outputText value="ERROR UPDATING ROUTE"/>
                    </h:panelGroup>
                </h:form>

            </h:form>
        </p:dialog>

        <p:dialog header="Edit station" id="edit-station-dlg" widgetVar="edit-station-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="edit-station-form" styleClass="form-table">

                <h:panelGrid columns="3">

                    <p:outputLabel for="edit-station-name" value="Station name" styleClass="sr-only"/>
                    <p:inputText id="edit-station-name" value="#{routeBean.editRouteHolder.station.name}" validator="#{routeBean.validateStationNameUniqueConstraint}" placeholder="Station name" styleClass="form-control" required="true" requiredMessage="Fill in Station's name">
                        <p:ajax update="msgEditStationName" event="keyup"/>
                    </p:inputText>
                    <p:message for="edit-station-name" id="msgEditStationName" display="text"/>

                    <p:outputLabel for="edit-station-location" value="Location" styleClass="sr-only"/>
                    <p:inputText id="edit-station-location" value="#{routeBean.editRouteHolder.station.location}" placeholder="Station location" styleClass="form-control" required="true" requiredMessage="Fill in Station's location">
                        <p:ajax update="msgEditStationLocation" event="keyup"/>
                    </p:inputText>
                    <p:message for="edit-station-location" id="msgEditStationLocation" display="text"/>

                    <p:outputLabel for="edit-station-info" value="Station info" styleClass="sr-only"/>
                    <p:inputTextarea id="edit-station-info" autoResize="false" rows="6" cols="30" value="#{routeBean.editRouteHolder.station.information}" styleClass="form-control" placeholder="Station information"/>
                    <p:message for="edit-station-info" id="msgEditStationInfo" display="text"/>

                    <h:outputLabel for="edit-station-time-limit" value="Time limit" styleClass="sr-only"/>
                    <p:spinner id="edit-station-time-limit" value="#{routeBean.editRouteHolder.station.timeLimit}" min="0" max="1000" placeholder="Time limit" styleClass="spinner"/>
                    <p:message for="edit-station-info" id="msgEditStationTimeLimit" display="text"/>

                    <h:outputLabel for="edit-station-relocation-time" value="Relocation time" styleClass="sr-only"/>
                    <p:spinner id="edit-station-relocation-time" value="#{routeBean.editRouteHolder.station.relocationTime}" min="0" max="1000" placeholder="Relocation time" styleClass="spinner"/>
                    <p:message for="edit-station-relocation-time" id="msgEditStationRelocationTime" display="text"/>

                </h:panelGrid>
                <p:commandButton value="Update station" styleClass="margin-top-10" update="@form :route-view-container" ajax="true"
                                 action="#{routeBean.updateStation}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed &amp;&amp; !args.errorUpdatingStation) PF('edit-station-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}"/>
                    <f:param name="routeId" value="#{routeBean.routeId}"/>
                    <f:param name="mode" value="view"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog id="add-stationmanager-dlg" header="Add station manager" widgetVar="add-stationmanager-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="add-stationmanager-form" styleClass="form-table">

                <h:panelGrid id="add-stationmanager-panel" columns="1">

                    <p:selectOneListbox id="select-stationmanager" value="#{routeBean.editRouteHolder.newStationManager}" var="e" filter="true" filterMatchMode="contains"
                            validator="#{routeBean.validateStationManagerUniqueConstraint}">
                        <f:selectItems value="#{routeBean.event.emailList}" var="email" itemLabel="#{email}" itemValue="#{email}" />

                        <p:column>
                            <h:outputText value="#{e}" />
                        </p:column>

                    </p:selectOneListbox>

                    <p:message for="select-stationmanager" id="msgSelectStationManager" display="text"/>

                </h:panelGrid>
                <p:commandButton value="Add station manager" styleClass="margin-top-10" update="@form :route-view-container" ajax="true"
                                 action="#{routeBean.addNewStationManager}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed &amp;&amp; !args.errorAddingStationManager) PF('add-stationmanager-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}" />
                    <f:param name="routeId" value="#{routeBean.routeId}" />
                    <f:param name="mode" value="view"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog id="view-add-group-dlg" header="Add group" widgetVar="view-add-group-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="view-add-group-form" styleClass="form-table">

                <h:panelGrid id="view-add-group-panel" columns="1">

                    <p:selectOneListbox id="add-group" value="#{routeBean.editRouteHolder.newGroupEmail}" var="e" filter="true" filterMatchMode="contains"
                                        validator="#{routeBean.validateGroupUniqueConstraint}">
                        <f:selectItems value="#{routeBean.event.emailList}" var="email" itemLabel="#{email}" itemValue="#{email}" />

                        <p:column>
                            <h:outputText value="#{e}" />
                        </p:column>

                    </p:selectOneListbox>

                    <p:message for="add-group" id="msgSelectGroup" display="text"/>

                </h:panelGrid>
                <p:commandButton value="Add group" styleClass="margin-top-10" update="@form :route-view-container" ajax="true"
                                 action="#{routeBean.addNewGroupToExistingRoute}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed &amp;&amp; !args.errorAddingGroup) PF('view-add-group-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}" />
                    <f:param name="routeId" value="#{routeBean.routeId}" />
                    <f:param name="mode" value="view"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:dialog header="Reorder groups" id="view-reorder-groups-dlg" widgetVar="view-reorder-groups-dlg" resizable="false" draggable="false" modal="true">
            <h:form id="view-reorder-groups-form" styleClass="form-table">

                <h:panelGrid id="view-reorder-groups-panel" columns="1">
                    <p:orderList value="#{routeBean.editRouteHolder.reorderGroups}" var="st" itemLabel="#{st}" itemValue="#{st}" controlsLocation="none" rendered="#{not empty routeBean.editRouteHolder.groups}"/>
                </h:panelGrid>

                <p:commandButton value="Update order" styleClass="margin-top-10" update="@form :route-view-container" ajax="true"
                                 action="#{routeBean.changeGroupOrderExistingRoute}"
                                 oncomplete="if (args &amp;&amp; !args.validationFailed &amp;&amp; !args.errorUpdateGroupOrder) PF('view-reorder-groups-dlg').hide()">
                    <f:param name="eventId" value="#{routeBean.eventId}" />
                    <f:param name="routeId" value="#{routeBean.routeId}" />
                    <f:param name="mode" value="view"/>
                </p:commandButton>

            </h:form>
        </p:dialog>

        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
            <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
        </p:confirmDialog>

        <!-- TOOLBAR -->
        <nav class="navbar navbar-inverse navbar-fixed-top">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <h:link styleClass="navbar-brand logo-navbar" outcome="index">OPEN DAYS</h:link>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false"><h:outputText value="#{userBB.name}"/><span class="caret"></span></a>
                            <ul class="dropdown-menu" role="menu">
                                <li><a href="#"><h:outputText value="#{strings['profile']}"/></a></li>
                                <li><a href="#"><h:outputText value="#{strings['settings']}"/></a></li>
                                <li class="divider"></li>
                                <li><h:outputLink value="#{root}/logout"><h:outputText value="#{strings['signout']}"/></h:outputLink></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container">

            <h:panelGroup id="route-view-container" layout="group" class="row" rendered="#{param.mode == 'view'}">
                <div class="col-md-12">
                    <div class="material-container">
                        <div class="box-toolbar">
                            <span class="left title-big"><h:outputText value="#{routeBean.route.name}"/></span>
                            <h:form>
                                <p:commandLink styleClass="right material-button-flat no-select" action="#{navBB.goEvent(routeBean.eventId)}">
                                    <span class="glyphicon glyphicon-chevron-left margin-right-10"/><h:outputText value="#{routeBean.event.name}"/>
                                    <f:param name="eventId" value="#{routeBean.eventId}"/>
                                    <f:param name="routeId" value="#{routeBean.routeId}"/>
                                    <f:param name="mode" value="view"/>
                                </p:commandLink>
                            </h:form>
                        </div>

                        <div class="box-content">
                            <div class="row">
                                <div class="col-md-6 material-container">
                                    <h:panelGroup layout="block" styleClass="box-toolbar divider" style="border-color: #{routeBean.route.hexColor}">
                                        <span class="left title"><h:outputText value="Route Information"/></span>
                                        <h:form>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="EDIT" action="#{routeBean.editRouteInfo}" update=":edit-route-info-dlg" oncomplete="PF('edit-route-info-dlg').show();">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                        </h:form>
                                    </h:panelGroup>
                                    <div class="box-content">
                                        <h:outputText styleClass="font500" value="Time:"/><br/>
                                        <h:outputText styleClass="font300" value="#{routeBean.route.date.toString('HH:mm')}"/><br/><br/>

                                        <h:outputText styleClass="font500" value="Information:"/><br/>
                                        <h:outputText styleClass="font300" value="#{routeBean.route.information}"/><br/><br/>
                                    </div>
                                </div>

                                <div class="col-md-6 material-container">
                                    <h:panelGroup layout="block" styleClass="box-toolbar divider" style="border-color: #{routeBean.route.hexColor}">
                                        <span class="left title"><h:outputText value="Stations"/></span>
                                        <h:form>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="ADD" action="#{routeBean.clearStation}" update=":view-add-station-dlg" oncomplete="PF('view-add-station-dlg').show();">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="REORDER" action="#{routeBean.setUpStationReorderMap}"
                                                           update=":view-reorder-station-dlg" oncomplete="PF('view-reorder-station-dlg').show();"
                                                           rendered="#{routeBean.route.stations.size() gt 1}">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                        </h:form>
                                    </h:panelGroup>
                                    <div class="box-content">
                                        <h:form>
                                        <p:dataTable value="#{routeBean.route.stations}" var="station" rowIndexVar="row" style="text-align: center;">
                                            <p:column headerText="Sequence Position">
                                                <h:outputText value="#{station.sequencePosition}"/>
                                            </p:column>

                                            <p:column headerText="Name">
                                                    <p:commandLink styleClass="material-button-flat no-select" value="#{station.name}" action="#{routeBean.showStation(row)}" update=":station-info-dlg" oncomplete="PF('station-info-dlg').show();">
                                                        <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                        <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                        <f:param name="mode" value="view"/>
                                                    </p:commandLink>
                                            </p:column>

                                            <p:column headerText="Location">
                                                <h:outputText value="#{station.location}"/>
                                            </p:column>

                                            <p:column headerText="Time limit">
                                                <h:outputText value="#{station.timeLimit} min"/>
                                            </p:column>

                                            <p:column headerText="Relocation time">
                                                <h:outputText value="#{station.relocationTime} min"/>
                                            </p:column>

                                            <p:column headerText="Actions" rendered="#{acl.hasPermission(routeBean.route.id, routeBean.route.ACLObjectIdentityClass, 'WRITE')}">
                                                <div class="right">
                                                    <p:commandButton styleClass="material-button-image image-button-edit ui-button-icon-only no-select"
                                                                     action="#{routeBean.editStation(station.id)}" value="" update=":edit-station-dlg" oncomplete="PF('edit-station-dlg').show();">
                                                        <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                        <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                        <f:param name="mode" value="view"/>
                                                    </p:commandButton>

                                                    <p:commandButton styleClass="material-button-image image-button-delete ui-button-icon-only no-select"
                                                                     actionListener="#{routeBean.removeStation(station.id)}" value="" update="@form :route-view-container">
                                                        <p:confirm header="Confirmation" message="Do you really want to delete this station?" icon="icon-empty"/>
                                                        <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                        <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                        <f:param name="mode" value="view"/>
                                                    </p:commandButton>
                                                </div>
                                            </p:column>

                                        </p:dataTable>
                                        </h:form>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6 material-container">
                                    <h:panelGroup layout="block" styleClass="box-toolbar divider" style="border-color: #{routeBean.route.hexColor}">
                                        <span class="left title"><h:outputText value="Groups"/></span>
                                        <h:form>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="ADD" action="#{routeBean.setUpEmptyRouteHolder}" update=":view-add-group-dlg" oncomplete="PF('view-add-group-dlg').show();">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="REORDER" action="#{routeBean.setUpGroupReorderMap}"
                                                           update=":view-reorder-groups-dlg" oncomplete="PF('view-reorder-groups-dlg').show();"
                                                           rendered="#{routeBean.route.groups.size() gt 1}">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                        </h:form>
                                    </h:panelGroup>
                                    <div class="box-content">
                                        <p:dataTable value="#{routeBean.route.groups}" var="group" style="text-align: center;">
                                            <p:column headerText="Group leader">
                                                <h:outputText value="#{group.guide.email}"/>
                                            </p:column>

                                            <p:column headerText="Starts at">
                                                <h:outputText value="#{routeBean.route.stations.get(group.startingPosition - 1).name}" rendered="#{(group.startingPosition - 1) lt routeBean.route.stations.size()}"/>
                                                <h:panelGroup layout="block" styleClass="table-alert alert-danger" rendered="#{(group.startingPosition - 1) ge routeBean.route.stations.size()}">
                                                    <h:outputText value="NO STATION"/>
                                                </h:panelGroup>
                                            </p:column>

                                            <p:column headerText="Start number">
                                                <h:outputText value="#{group.startingPosition}"/>
                                            </p:column>

                                            <p:column rendered="#{acl.hasPermission(routeBean.route.id, routeBean.route.ACLObjectIdentityClass, 'WRITE')}">
                                                <div class="right">
                                                    <h:form>
                                                        <p:commandButton styleClass="material-button-image image-button-delete ui-button-icon-only no-select"
                                                                         actionListener="#{routeBean.removeGroup(group.id)}" value="" update="@form :route-view-container">
                                                            <p:confirm header="Confirmation" message="Do you really want to delete this group?" icon="icon-empty"/>
                                                            <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                            <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                            <f:param name="mode" value="view"/>
                                                        </p:commandButton>
                                                    </h:form>
                                                </div>
                                            </p:column>

                                        </p:dataTable>
                                    </div>
                                </div>

                                <div class="col-md-6 material-container">
                                    <h:panelGroup layout="block" styleClass="box-toolbar divider" style="border-color: #{routeBean.route.hexColor}">
                                        <span class="left title"><h:outputText value="Station Managers"/></span>
                                        <h:form>
                                            <p:commandLink styleClass="right material-button-flat no-select" value="ADD" action="#{routeBean.setUpEmptyRouteHolder}" update=":add-stationmanager-dlg" oncomplete="PF('add-stationmanager-dlg').show();">
                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                <f:param name="mode" value="view"/>
                                            </p:commandLink>
                                        </h:form>
                                    </h:panelGroup>
                                    <div class="box-content">
                                        <p:dataTable value="#{routeBean.route.stationManagers}" var="manager" styleClass="no-header">
                                            <p:column>
                                                <h:outputText value="#{manager.email}"/>
                                            </p:column>

                                            <p:column rendered="#{acl.hasPermission(routeBean.route.id, routeBean.route.ACLObjectIdentityClass, 'WRITE')}">
                                                <div class="right">
                                                    <h:form>
                                                        <p:commandButton styleClass="material-button-image image-button-delete ui-button-icon-only no-select"
                                                                         actionListener="#{routeBean.removeStationManager(manager.email)}" value="" update="@form :route-view-container">
                                                            <p:confirm header="Confirmation" message="Do you really want to delete this station manager?" icon="icon-empty"/>
                                                            <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                            <f:param name="routeId" value="#{routeBean.routeId}"/>
                                                            <f:param name="mode" value="view"/>
                                                        </p:commandButton>
                                                    </h:form>
                                                </div>
                                            </p:column>
                                        </p:dataTable>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </h:panelGroup>

            <h:panelGroup layout="group" class="row" rendered="#{param.mode == 'create'}">

                <div class="col-md-12">

                    <div class="material-container">

                        <div class="box-toolbar">
                            <span class="left title">CREATE ROUTE</span>
                            <h:form>
                                <p:commandLink styleClass="right material-button-flat no-select" action="#{navBB.goEvent(routeBean.eventId)}">
                                    <span class="glyphicon glyphicon-chevron-left margin-right-10"/><h:outputText value="#{routeBean.event.name}"/>
                                    <p:confirm header="Confirmation" message="Are you sure you want to leave without saving?" icon="icon-empty"/>
                                    <f:param name="eventId" value="#{routeBean.eventId}"/>
                                    <f:param name="mode" value="create"/>
                                </p:commandLink>
                            </h:form>
                        </div>

                        <div class="box-content">
                            <h:form id="createRouteForm" styleClass="form-table">

                                <div class="row">

                                    <div class="col-md-6 material-container">

                                        <div class="box-toolbar divider">
                                            <span class="left title"><h:outputText value="Route Information"/></span>
                                        </div>
                                        <div class="box-content">
                                            <h:panelGrid id="panel" columns="3">
                                                <p:outputLabel for="colorPicker" value="COLORPICKER" styleClass="sr-only"/>
                                                <p:colorPicker id="colorPicker" value="#{routeBean.cvo.routeColor}" required="true" requiredMessage="Pick a color!"/>
                                                <p:message for="colorPicker" id="msgColorPicker" display="text"/>

                                                <p:outputLabel for="routeName" value="ROUTENAME" styleClass="sr-only"/>
                                                <p:inputText id="routeName" value="#{routeBean.cvo.routeName}" placeholder="Route name" styleClass="form-control" required="true" requiredMessage="Fill in name!"/>
                                                <p:message for="routeName" id="msgRouteName" display="text"/>

                                                <p:outputLabel for="routeInformation" value="ROUTEINFO" styleClass="sr-only"/>
                                                <p:inputTextarea id="routeInformation" value="#{routeBean.cvo.routeInfo}" placeholder="Route information" rows="10" cols="50" styleClass="form-control"/>
                                                <p:message for="routeInformation" id="msgRouteInformation" display="text"/>
                                            </h:panelGrid>
                                        </div>

                                    </div>
                                    <div class="col-md-6 material-container">
                                        <div class="box-toolbar divider">
                                            <span class="left title"><h:outputText value="Route Times"/></span>
                                            <h:outputLink class="right material-button-flat no-select" value="javascript:void(0)" onclick="PF('add-time-dlg').show();">ADD</h:outputLink>
                                        </div>
                                        <div class="box-content">
                                            <h:panelGrid id="panel3" columns="1">
                                                <p:dataTable var="time" value="#{routeBean.cvo.routeTimes}" rendered="#{not empty routeBean.cvo.routeTimes}" styleClass="no-header">

                                                    <p:column styleClass="event-date">
                                                        <h:outputText value="#{time.toString('HH:mm')}" />
                                                    </p:column>

                                                    <p:column>
                                                            <p:commandButton styleClass="material-button-image image-button-delete ui-button-icon-only no-select"
                                                                             actionListener="#{routeBean.cvo.removeRouteTime(time)}" value="" update="@form" immediate="true">
                                                                <p:confirm header="Confirmation" message="Do you really want to delete this time?" icon="icon-empty"/>
                                                                <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                                <f:param name="mode" value="create"/>
                                                            </p:commandButton>
                                                    </p:column>

                                                </p:dataTable>

                                                <h:panelGroup layout="block" styleClass="alert alert-info" rendered="#{empty routeBean.cvo.routeTimes}" >
                                                    <h:outputText value="No times added yet."/>
                                                </h:panelGroup>

                                                <h:inputHidden id="routeTimeHidden" validator="#{routeBean.validateRouteTimes}"/>
                                                <p:message for="routeTimeHidden" id="msgRouteTimeHidden" display="text"/>

                                            </h:panelGrid>
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <h:panelGroup layout="block" id="stations-container" class="col-md-6 material-container">
                                        <div class="box-toolbar divider">
                                            <span class="left title"><h:outputText value="Stations"/></span>
                                            <h:outputLink class="right material-button-flat no-select" value="javascript:void(0)" onclick="PF('add-station-dlg').show();">ADD</h:outputLink>
                                            <h:outputLink class="right material-button-flat no-select" value="javascript:void(0)" onclick="PF('reorder-station-dlg').show();" rendered="#{not empty routeBean.cvo.stations}">REORDER</h:outputLink>
                                        </div>
                                        <div class="box-content">
                                            <h:panelGrid id="panel5" columns="1">
                                                <p:dataTable var="station" value="#{routeBean.cvo.stations}" rendered="#{not empty routeBean.cvo.stations}" styleClass="no-header" rowIndexVar="row">

                                                    <p:column styleClass="event-date">
                                                        <h:outputText value="#{row+1}" />
                                                    </p:column>

                                                    <p:column styleClass="event-date">
                                                        <h:outputText value="#{station.name}" />
                                                    </p:column>

                                                    <p:column styleClass="event-date">
                                                        <h:outputText value="#{station.location}" />
                                                    </p:column>

                                                    <p:column>
                                                        <p:commandButton styleClass="material-button-image image-button-delete ui-button-icon-only no-select"
                                                                         actionListener="#{routeBean.cvo.removeStation(station)}" value="" update="@form :reorder-station-form" immediate="true">
                                                            <p:confirm header="Confirmation" message="Do you really want to delete this station?" icon="icon-empty"/>
                                                            <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                            <f:param name="mode" value="create"/>
                                                        </p:commandButton>
                                                    </p:column>
                                                </p:dataTable>

                                                <h:panelGroup layout="block" styleClass="alert alert-info" rendered="#{empty routeBean.cvo.stations}" >
                                                    <h:outputText value="No stations added yet."/>
                                                </h:panelGroup>
                                            </h:panelGrid>

                                        </div>

                                    </h:panelGroup>

                                    <div class="col-md-6 material-container">
                                        <div class="box-toolbar divider">
                                            <span class="left title"><h:outputText value="Station Managers"/></span>
                                        </div>
                                        <div id="station-manager-grid" class="box-content">

                                            <p:selectManyCheckbox id="grid" value="#{routeBean.cvo.stationManagers}" layout="grid" columns="2" style="margin-right: 10px;">
                                                <f:selectItems value="#{routeBean.event.emailList}" var="email" itemLabel="#{email}" itemValue="#{email}"/>
                                            </p:selectManyCheckbox>

                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <h:panelGroup layout="block" id="groups-container" class="col-md-6 material-container">
                                        <div class="box-toolbar divider">
                                            <span class="left title"><h:outputText value="Groups"/></span>
                                            <h:outputLink class="right material-button-flat no-select" value="javascript:void(0)" onclick="PF('add-group-dlg').show();">ADD</h:outputLink>
                                            <h:outputLink class="right material-button-flat no-select" value="javascript:void(0)" onclick="PF('reorder-group-dlg').show();" rendered="#{not empty routeBean.cvo.groups}">REORDER</h:outputLink>
                                        </div>
                                        <div class="box-content">
                                            <h:panelGrid id="panel4" columns="1">
                                                <p:dataTable var="group" value="#{routeBean.cvo.groups}" rendered="#{not empty routeBean.cvo.groups}" styleClass="no-header" rowIndexVar="row">

                                                    <p:column styleClass="event-date">
                                                        <h:outputText value="#{group}" />
                                                    </p:column>

                                                    <p:column styleClass="event-date">
                                                        <h:outputText value="#{routeBean.cvo.stations.get(row).name}" rendered="#{routeBean.cvo.stations.size() gt row}"/>

                                                        <h:panelGroup layout="block" styleClass="table-alert alert-danger" rendered="#{empty routeBean.cvo.stations or routeBean.cvo.stations.size() le row}">
                                                            <h:outputText value="NO STATION"/>
                                                        </h:panelGroup>
                                                    </p:column>

                                                    <p:column>
                                                        <p:commandButton styleClass="material-button-image image-button-delete ui-button-icon-only no-select"
                                                                         actionListener="#{routeBean.cvo.removeGroup(group)}" value="" update="@form :reorder-group-form" immediate="true">
                                                            <p:confirm header="Confirmation" message="Do you really want to delete this group?" icon="icon-empty"/>
                                                            <f:param name="eventId" value="#{routeBean.eventId}"/>
                                                            <f:param name="mode" value="create"/>
                                                        </p:commandButton>
                                                    </p:column>
                                                </p:dataTable>

                                                <h:panelGroup layout="block" styleClass="alert alert-info" rendered="#{empty routeBean.cvo.groups}" >
                                                    <h:outputText value="No groups added yet."/>
                                                </h:panelGroup>

                                                <h:inputHidden id="groupsHidden" validator="#{routeBean.validateGroups}"/>
                                                <p:message for="groupsHidden" id="msgGroupsHidden" display="text" styleClass="no-margin"/>
                                            </h:panelGrid>
                                        </div>
                                    </h:panelGroup>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 material-container">
                                        <p:commandButton ajax="false" value="Create route" styleClass="btn btn-primary button-register" update="@form" action="#{routeBean.createRoute}">
                                            <f:param name="eventId" value="#{routeBean.eventId}"/>
                                            <f:param name="mode" value="create"/>
                                        </p:commandButton>
                                    </div>
                                </div>

                            </h:form>
                        </div>

                    </div>
                </div>

            </h:panelGroup>

        </div>

    </h:body>
</f:view>
</html>